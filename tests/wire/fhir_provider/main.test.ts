/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../mock-server/MockServerPool";
import { phenomlClient } from "../../../src/Client";

describe("FhirProvider", () => {
    test("create", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            name: "Epic Sandbox",
            provider: "athenahealth",
            auth_method: "client_secret",
            base_url: "https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4",
        };
        const rawResponseBody = {
            success: true,
            message: "Fhir provider created successfully",
            data: {
                id: "1716d214-de93-43a4-aa6b-a878d864e2ad",
                user_id: "user-123",
                name: "Epic Sandbox",
                description: "Epic sandbox environment for testing",
                provider: "athenahealth",
                base_url: "https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4",
                client_id: "your-client-id",
                auth_configs: {
                    key: {
                        auth_config_id: "auth-config-123",
                        is_active_auth_config: true,
                        public_key_cert_pem: "-----BEGIN CERTIFICATE-----\n...",
                        credential_expiry: "2024-12-31T23:59:59Z",
                        scopes: "system/Patient.read system/Observation.read",
                    },
                },
                is_active: true,
                last_updated: "2024-01-15T10:30:00Z",
            },
        };
        server
            .mockEndpoint()
            .post("/fhir-provider/create")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.fhirProvider.create({
            name: "Epic Sandbox",
            provider: "athenahealth",
            auth_method: "client_secret",
            base_url: "https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4",
        });
        expect(response).toEqual({
            success: true,
            message: "Fhir provider created successfully",
            data: {
                id: "1716d214-de93-43a4-aa6b-a878d864e2ad",
                user_id: "user-123",
                name: "Epic Sandbox",
                description: "Epic sandbox environment for testing",
                provider: "athenahealth",
                base_url: "https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4",
                client_id: "your-client-id",
                auth_configs: {
                    key: {
                        auth_config_id: "auth-config-123",
                        is_active_auth_config: true,
                        public_key_cert_pem: "-----BEGIN CERTIFICATE-----\n...",
                        credential_expiry: "2024-12-31T23:59:59Z",
                        scopes: "system/Patient.read system/Observation.read",
                    },
                },
                is_active: true,
                last_updated: "2024-01-15T10:30:00Z",
            },
        });
    });

    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            success: true,
            message: "Fhir providers retrieved successfully",
            fhir_providers: [
                {
                    id: "1716d214-de93-43a4-aa6b-a878d864e2ad",
                    user_id: "user-123",
                    name: "Epic Sandbox",
                    description: "Epic sandbox environment for testing",
                    provider: "athenahealth",
                    base_url: "https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4",
                    client_id: "your-client-id",
                    auth_configs: {
                        key: {
                            auth_config_id: "auth-config-123",
                            is_active_auth_config: true,
                            public_key_cert_pem: "-----BEGIN CERTIFICATE-----\n...",
                            credential_expiry: "2024-12-31T23:59:59Z",
                            scopes: "system/Patient.read system/Observation.read",
                        },
                    },
                    is_active: true,
                    last_updated: "2024-01-15T10:30:00Z",
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/fhir-provider/list")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.fhirProvider.list();
        expect(response).toEqual({
            success: true,
            message: "Fhir providers retrieved successfully",
            fhir_providers: [
                {
                    id: "1716d214-de93-43a4-aa6b-a878d864e2ad",
                    user_id: "user-123",
                    name: "Epic Sandbox",
                    description: "Epic sandbox environment for testing",
                    provider: "athenahealth",
                    base_url: "https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4",
                    client_id: "your-client-id",
                    auth_configs: {
                        key: {
                            auth_config_id: "auth-config-123",
                            is_active_auth_config: true,
                            public_key_cert_pem: "-----BEGIN CERTIFICATE-----\n...",
                            credential_expiry: "2024-12-31T23:59:59Z",
                            scopes: "system/Patient.read system/Observation.read",
                        },
                    },
                    is_active: true,
                    last_updated: "2024-01-15T10:30:00Z",
                },
            ],
        });
    });

    test("get", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            success: true,
            message: "Fhir provider created successfully",
            data: {
                id: "1716d214-de93-43a4-aa6b-a878d864e2ad",
                user_id: "user-123",
                name: "Epic Sandbox",
                description: "Epic sandbox environment for testing",
                provider: "athenahealth",
                base_url: "https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4",
                client_id: "your-client-id",
                auth_configs: {
                    key: {
                        auth_config_id: "auth-config-123",
                        is_active_auth_config: true,
                        public_key_cert_pem: "-----BEGIN CERTIFICATE-----\n...",
                        credential_expiry: "2024-12-31T23:59:59Z",
                        scopes: "system/Patient.read system/Observation.read",
                    },
                },
                is_active: true,
                last_updated: "2024-01-15T10:30:00Z",
            },
        };
        server
            .mockEndpoint()
            .get("/fhir-provider/fhir_provider_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.fhirProvider.get("fhir_provider_id");
        expect(response).toEqual({
            success: true,
            message: "Fhir provider created successfully",
            data: {
                id: "1716d214-de93-43a4-aa6b-a878d864e2ad",
                user_id: "user-123",
                name: "Epic Sandbox",
                description: "Epic sandbox environment for testing",
                provider: "athenahealth",
                base_url: "https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4",
                client_id: "your-client-id",
                auth_configs: {
                    key: {
                        auth_config_id: "auth-config-123",
                        is_active_auth_config: true,
                        public_key_cert_pem: "-----BEGIN CERTIFICATE-----\n...",
                        credential_expiry: "2024-12-31T23:59:59Z",
                        scopes: "system/Patient.read system/Observation.read",
                    },
                },
                is_active: true,
                last_updated: "2024-01-15T10:30:00Z",
            },
        });
    });

    test("delete", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { success: true, message: "Fhir provider deleted successfully" };
        server
            .mockEndpoint()
            .delete("/fhir-provider/fhir_provider_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.fhirProvider.delete("fhir_provider_id");
        expect(response).toEqual({
            success: true,
            message: "Fhir provider deleted successfully",
        });
    });

    test("addAuthConfig", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ token: "test", environment: server.baseUrl });
        const rawRequestBody = { auth_method: "client_secret" };
        const rawResponseBody = {
            success: true,
            message: "Fhir provider created successfully",
            data: {
                id: "1716d214-de93-43a4-aa6b-a878d864e2ad",
                user_id: "user-123",
                name: "Epic Sandbox",
                description: "Epic sandbox environment for testing",
                provider: "athenahealth",
                base_url: "https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4",
                client_id: "your-client-id",
                auth_configs: {
                    key: {
                        auth_config_id: "auth-config-123",
                        is_active_auth_config: true,
                        public_key_cert_pem: "-----BEGIN CERTIFICATE-----\n...",
                        credential_expiry: "2024-12-31T23:59:59Z",
                        scopes: "system/Patient.read system/Observation.read",
                    },
                },
                is_active: true,
                last_updated: "2024-01-15T10:30:00Z",
            },
        };
        server
            .mockEndpoint()
            .patch("/fhir-provider/1716d214-de93-43a4-aa6b-a878d864e2ad/add-auth-config")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.fhirProvider.addAuthConfig("1716d214-de93-43a4-aa6b-a878d864e2ad", {
            auth_method: "client_secret",
        });
        expect(response).toEqual({
            success: true,
            message: "Fhir provider created successfully",
            data: {
                id: "1716d214-de93-43a4-aa6b-a878d864e2ad",
                user_id: "user-123",
                name: "Epic Sandbox",
                description: "Epic sandbox environment for testing",
                provider: "athenahealth",
                base_url: "https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4",
                client_id: "your-client-id",
                auth_configs: {
                    key: {
                        auth_config_id: "auth-config-123",
                        is_active_auth_config: true,
                        public_key_cert_pem: "-----BEGIN CERTIFICATE-----\n...",
                        credential_expiry: "2024-12-31T23:59:59Z",
                        scopes: "system/Patient.read system/Observation.read",
                    },
                },
                is_active: true,
                last_updated: "2024-01-15T10:30:00Z",
            },
        });
    });

    test("setActiveAuthConfig", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ token: "test", environment: server.baseUrl });
        const rawRequestBody = { auth_config_id: "auth-config-123" };
        const rawResponseBody = {
            success: true,
            message: "FHIR provider auth config set as active successfully",
            data: {
                id: "1716d214-de93-43a4-aa6b-a878d864e2ad",
                user_id: "user-123",
                name: "Epic Sandbox",
                description: "Epic sandbox environment for testing",
                provider: "athenahealth",
                base_url: "https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4",
                client_id: "your-client-id",
                auth_configs: {
                    key: {
                        auth_config_id: "auth-config-123",
                        is_active_auth_config: true,
                        public_key_cert_pem: "-----BEGIN CERTIFICATE-----\n...",
                        credential_expiry: "2024-12-31T23:59:59Z",
                        scopes: "system/Patient.read system/Observation.read",
                    },
                },
                is_active: true,
                last_updated: "2024-01-15T10:30:00Z",
            },
        };
        server
            .mockEndpoint()
            .patch("/fhir-provider/1716d214-de93-43a4-aa6b-a878d864e2ad/set-active-auth-config")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.fhirProvider.setActiveAuthConfig("1716d214-de93-43a4-aa6b-a878d864e2ad", {
            auth_config_id: "auth-config-123",
        });
        expect(response).toEqual({
            success: true,
            message: "FHIR provider auth config set as active successfully",
            data: {
                id: "1716d214-de93-43a4-aa6b-a878d864e2ad",
                user_id: "user-123",
                name: "Epic Sandbox",
                description: "Epic sandbox environment for testing",
                provider: "athenahealth",
                base_url: "https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4",
                client_id: "your-client-id",
                auth_configs: {
                    key: {
                        auth_config_id: "auth-config-123",
                        is_active_auth_config: true,
                        public_key_cert_pem: "-----BEGIN CERTIFICATE-----\n...",
                        credential_expiry: "2024-12-31T23:59:59Z",
                        scopes: "system/Patient.read system/Observation.read",
                    },
                },
                is_active: true,
                last_updated: "2024-01-15T10:30:00Z",
            },
        });
    });

    test("removeAuthConfig", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ token: "test", environment: server.baseUrl });
        const rawRequestBody = { auth_config_id: "auth-config-123" };
        const rawResponseBody = {
            success: true,
            message: "Auth configuration removed successfully",
            data: {
                id: "1716d214-de93-43a4-aa6b-a878d864e2ad",
                user_id: "user-123",
                name: "Epic Sandbox",
                description: "Epic sandbox environment for testing",
                provider: "athenahealth",
                base_url: "https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4",
                client_id: "your-client-id",
                auth_configs: {
                    key: {
                        auth_config_id: "auth-config-123",
                        is_active_auth_config: true,
                        public_key_cert_pem: "-----BEGIN CERTIFICATE-----\n...",
                        credential_expiry: "2024-12-31T23:59:59Z",
                        scopes: "system/Patient.read system/Observation.read",
                    },
                },
                is_active: true,
                last_updated: "2024-01-15T10:30:00Z",
            },
        };
        server
            .mockEndpoint()
            .patch("/fhir-provider/1716d214-de93-43a4-aa6b-a878d864e2ad/remove-auth-config")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.fhirProvider.removeAuthConfig("1716d214-de93-43a4-aa6b-a878d864e2ad", {
            auth_config_id: "auth-config-123",
        });
        expect(response).toEqual({
            success: true,
            message: "Auth configuration removed successfully",
            data: {
                id: "1716d214-de93-43a4-aa6b-a878d864e2ad",
                user_id: "user-123",
                name: "Epic Sandbox",
                description: "Epic sandbox environment for testing",
                provider: "athenahealth",
                base_url: "https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4",
                client_id: "your-client-id",
                auth_configs: {
                    key: {
                        auth_config_id: "auth-config-123",
                        is_active_auth_config: true,
                        public_key_cert_pem: "-----BEGIN CERTIFICATE-----\n...",
                        credential_expiry: "2024-12-31T23:59:59Z",
                        scopes: "system/Patient.read system/Observation.read",
                    },
                },
                is_active: true,
                last_updated: "2024-01-15T10:30:00Z",
            },
        });
    });
});
