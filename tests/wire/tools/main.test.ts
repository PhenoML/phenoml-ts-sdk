// This file was auto-generated by Fern from our API Definition.

import * as phenoml from "../../../src/api/index";
import { phenomlClient } from "../../../src/Client";
import { mockServerPool } from "../../mock-server/MockServerPool";

describe("ToolsClient", () => {
    test("createFhirResource (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { resource: "auto", text: "Patient John Doe has severe asthma with acute exacerbation" };
        const rawResponseBody = {
            fhir_resource: {
                resourceType: "Condition",
                id: "condition-123",
                code: { coding: [{ system: "http://snomed.info/sct", code: "195967001", display: "Asthma" }] },
                subject: { reference: "Patient/patient-123", display: "John Doe" },
            },
            fhir_id: "condition-123",
            success: true,
            message: "FHIR resource created and stored in FHIR server successfully",
        };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-create")
            .header("X-Phenoml-On-Behalf-Of", "Patient/550e8400-e29b-41d4-a716-446655440000")
            .header(
                "X-Phenoml-Fhir-Provider",
                "550e8400-e29b-41d4-a716-446655440000:eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c...",
            )
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.tools.createFhirResource({
            "X-Phenoml-On-Behalf-Of": "Patient/550e8400-e29b-41d4-a716-446655440000",
            "X-Phenoml-Fhir-Provider":
                "550e8400-e29b-41d4-a716-446655440000:eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c...",
            resource: "auto",
            text: "Patient John Doe has severe asthma with acute exacerbation",
        });
        expect(response).toEqual({
            fhir_resource: {
                resourceType: "Condition",
                id: "condition-123",
                code: {
                    coding: [
                        {
                            system: "http://snomed.info/sct",
                            code: "195967001",
                            display: "Asthma",
                        },
                    ],
                },
                subject: {
                    reference: "Patient/patient-123",
                    display: "John Doe",
                },
            },
            fhir_id: "condition-123",
            success: true,
            message: "FHIR resource created and stored in FHIR server successfully",
        });
    });

    test("createFhirResource (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { resource: "auto", text: "text" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-create")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.createFhirResource({
                resource: "auto",
                text: "text",
            });
        }).rejects.toThrow(phenoml.tools.BadRequestError);
    });

    test("createFhirResource (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { resource: "auto", text: "text" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-create")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.createFhirResource({
                resource: "auto",
                text: "text",
            });
        }).rejects.toThrow(phenoml.tools.UnauthorizedError);
    });

    test("createFhirResource (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { resource: "auto", text: "text" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-create")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.createFhirResource({
                resource: "auto",
                text: "text",
            });
        }).rejects.toThrow(phenoml.tools.ForbiddenError);
    });

    test("createFhirResource (5)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { resource: "auto", text: "text" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-create")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(424)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.createFhirResource({
                resource: "auto",
                text: "text",
            });
        }).rejects.toThrow(phenoml.tools.FailedDependencyError);
    });

    test("createFhirResource (6)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { resource: "auto", text: "text" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-create")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.createFhirResource({
                resource: "auto",
                text: "text",
            });
        }).rejects.toThrow(phenoml.tools.InternalServerError);
    });

    test("createFhirResourcesMulti (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            text: "John Smith, 45-year-old male, diagnosed with Type 2 Diabetes. Prescribed Metformin 500mg twice daily.",
            provider: "medplum",
        };
        const rawResponseBody = {
            success: true,
            message: "Created 3 resources",
            response_bundle: { resourceType: "Bundle", type: "transaction-response", entry: [{ key: "value" }] },
            resource_info: [
                {
                    tempId: "urn:uuid:patient-abc123",
                    resourceType: "Patient",
                    description: "John Smith, 45-year-old male",
                },
            ],
        };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-create-multi")
            .header("X-Phenoml-On-Behalf-Of", "Patient/550e8400-e29b-41d4-a716-446655440000")
            .header(
                "X-Phenoml-Fhir-Provider",
                "550e8400-e29b-41d4-a716-446655440000:eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c...",
            )
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.tools.createFhirResourcesMulti({
            "X-Phenoml-On-Behalf-Of": "Patient/550e8400-e29b-41d4-a716-446655440000",
            "X-Phenoml-Fhir-Provider":
                "550e8400-e29b-41d4-a716-446655440000:eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c...",
            text: "John Smith, 45-year-old male, diagnosed with Type 2 Diabetes. Prescribed Metformin 500mg twice daily.",
            provider: "medplum",
        });
        expect(response).toEqual({
            success: true,
            message: "Created 3 resources",
            response_bundle: {
                resourceType: "Bundle",
                type: "transaction-response",
                entry: [
                    {
                        key: "value",
                    },
                ],
            },
            resource_info: [
                {
                    tempId: "urn:uuid:patient-abc123",
                    resourceType: "Patient",
                    description: "John Smith, 45-year-old male",
                },
            ],
        });
    });

    test("createFhirResourcesMulti (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "text", provider: "provider" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-create-multi")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.createFhirResourcesMulti({
                text: "text",
                provider: "provider",
            });
        }).rejects.toThrow(phenoml.tools.BadRequestError);
    });

    test("createFhirResourcesMulti (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "text", provider: "provider" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-create-multi")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.createFhirResourcesMulti({
                text: "text",
                provider: "provider",
            });
        }).rejects.toThrow(phenoml.tools.UnauthorizedError);
    });

    test("createFhirResourcesMulti (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "text", provider: "provider" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-create-multi")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.createFhirResourcesMulti({
                text: "text",
                provider: "provider",
            });
        }).rejects.toThrow(phenoml.tools.ForbiddenError);
    });

    test("createFhirResourcesMulti (5)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "text", provider: "provider" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-create-multi")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(424)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.createFhirResourcesMulti({
                text: "text",
                provider: "provider",
            });
        }).rejects.toThrow(phenoml.tools.FailedDependencyError);
    });

    test("createFhirResourcesMulti (6)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "text", provider: "provider" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-create-multi")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.createFhirResourcesMulti({
                text: "text",
                provider: "provider",
            });
        }).rejects.toThrow(phenoml.tools.InternalServerError);
    });

    test("searchFhirResources (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "Find all appointments for patient John Doe next week" };
        const rawResponseBody = {
            resource_type: "Appointment",
            search_params: "patient=Patient/patient-123&date=ge2024-01-15&date=le2024-01-22",
            fhir_results: [
                {
                    resourceType: "Appointment",
                    id: "appointment-123",
                    status: "booked",
                    start: "2024-01-16T10:00:00Z",
                    end: "2024-01-16T11:00:00Z",
                    participant: [{ actor: { reference: "Patient/patient-123", display: "John Doe" } }],
                },
            ],
            success: true,
            message: "Search query generated and executed in FHIR server successfully. Found 1 results.",
        };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-search")
            .header("X-Phenoml-On-Behalf-Of", "Patient/550e8400-e29b-41d4-a716-446655440000")
            .header(
                "X-Phenoml-Fhir-Provider",
                "550e8400-e29b-41d4-a716-446655440000:eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c...",
            )
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.tools.searchFhirResources({
            "X-Phenoml-On-Behalf-Of": "Patient/550e8400-e29b-41d4-a716-446655440000",
            "X-Phenoml-Fhir-Provider":
                "550e8400-e29b-41d4-a716-446655440000:eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c...",
            text: "Find all appointments for patient John Doe next week",
        });
        expect(response).toEqual({
            resource_type: "Appointment",
            search_params: "patient=Patient/patient-123&date=ge2024-01-15&date=le2024-01-22",
            fhir_results: [
                {
                    resourceType: "Appointment",
                    id: "appointment-123",
                    status: "booked",
                    start: "2024-01-16T10:00:00Z",
                    end: "2024-01-16T11:00:00Z",
                    participant: [
                        {
                            actor: {
                                reference: "Patient/patient-123",
                                display: "John Doe",
                            },
                        },
                    ],
                },
            ],
            success: true,
            message: "Search query generated and executed in FHIR server successfully. Found 1 results.",
        });
    });

    test("searchFhirResources (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "text" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-search")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.searchFhirResources({
                text: "text",
            });
        }).rejects.toThrow(phenoml.tools.BadRequestError);
    });

    test("searchFhirResources (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "text" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-search")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.searchFhirResources({
                text: "text",
            });
        }).rejects.toThrow(phenoml.tools.UnauthorizedError);
    });

    test("searchFhirResources (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "text" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-search")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.searchFhirResources({
                text: "text",
            });
        }).rejects.toThrow(phenoml.tools.ForbiddenError);
    });

    test("searchFhirResources (5)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "text" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-search")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(424)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.searchFhirResources({
                text: "text",
            });
        }).rejects.toThrow(phenoml.tools.FailedDependencyError);
    });

    test("searchFhirResources (6)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "text" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/lang2fhir-and-search")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.searchFhirResources({
                text: "text",
            });
        }).rejects.toThrow(phenoml.tools.InternalServerError);
    });

    test("analyzeCohort (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            text: "female patients over 20 with diabetes but not hypertension",
            provider: "550e8400-e29b-41d4-a716-446655440000",
        };
        const rawResponseBody = {
            success: true,
            message: "Cohort analysis completed successfully. Found 33 patients from 2 search concepts.",
            patientIds: ["patient-123", "patient-456", "patient-789"],
            patientCount: 33,
            queries: [
                {
                    resource_type: "Patient",
                    search_params: "gender=female&birthdate=le2004-01-01",
                    concept: "female patients over 20",
                    exclude: false,
                },
                {
                    resource_type: "Condition",
                    search_params: "code=55822004",
                    concept: "hyperlipidemia",
                    exclude: false,
                },
            ],
        };
        server
            .mockEndpoint()
            .post("/tools/cohort")
            .header("X-Phenoml-On-Behalf-Of", "Patient/550e8400-e29b-41d4-a716-446655440000")
            .header(
                "X-Phenoml-Fhir-Provider",
                "550e8400-e29b-41d4-a716-446655440000:eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c...",
            )
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.tools.analyzeCohort({
            "X-Phenoml-On-Behalf-Of": "Patient/550e8400-e29b-41d4-a716-446655440000",
            "X-Phenoml-Fhir-Provider":
                "550e8400-e29b-41d4-a716-446655440000:eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c...",
            text: "female patients over 20 with diabetes but not hypertension",
            provider: "550e8400-e29b-41d4-a716-446655440000",
        });
        expect(response).toEqual({
            success: true,
            message: "Cohort analysis completed successfully. Found 33 patients from 2 search concepts.",
            patientIds: ["patient-123", "patient-456", "patient-789"],
            patientCount: 33,
            queries: [
                {
                    resource_type: "Patient",
                    search_params: "gender=female&birthdate=le2004-01-01",
                    concept: "female patients over 20",
                    exclude: false,
                },
                {
                    resource_type: "Condition",
                    search_params: "code=55822004",
                    concept: "hyperlipidemia",
                    exclude: false,
                },
            ],
        });
    });

    test("analyzeCohort (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "text", provider: "provider" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/cohort")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.analyzeCohort({
                text: "text",
                provider: "provider",
            });
        }).rejects.toThrow(phenoml.tools.BadRequestError);
    });

    test("analyzeCohort (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "text", provider: "provider" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/cohort")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.analyzeCohort({
                text: "text",
                provider: "provider",
            });
        }).rejects.toThrow(phenoml.tools.UnauthorizedError);
    });

    test("analyzeCohort (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "text", provider: "provider" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/cohort")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.analyzeCohort({
                text: "text",
                provider: "provider",
            });
        }).rejects.toThrow(phenoml.tools.ForbiddenError);
    });

    test("analyzeCohort (5)", async () => {
        const server = mockServerPool.createServer();
        const client = new phenomlClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { text: "text", provider: "provider" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/tools/cohort")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.tools.analyzeCohort({
                text: "text",
                provider: "provider",
            });
        }).rejects.toThrow(phenoml.tools.InternalServerError);
    });
});
